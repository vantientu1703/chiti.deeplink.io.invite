<!DOCTYPE html>
<html>
    <head>
        <title>Chiti...</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="style.css"> <!-- Ensure you link to your CSS file -->
        <link rel="icon" type="image/png" href="/images/logo.png">

        <script type="text/javascript">
            // var appStoreUrl = 'https://apps.apple.com/vn/app/chiti/id1522912419';
            // var playStoreUrl = 'https://play.google.com/store/apps/details?id=com.vantientu.RiceBooks&pcampaignid=web_share';
            // var facebookPage = 'https://www.facebook.com/profile.php?id=100066968462985'
            var isBlurred = false;
            var didFallback = false;

            function openAppOrStore() {

                var now = new Date().valueOf();

                window.addEventListener('blur', function() {
                    isBlurred = true;
                });

                window.addEventListener('focus', function() {
                    isBlurred = false;
                    // openAppOrStore();
                });

                // Assuming the URL is something like "?productName=Widget&price=19.99"
                const link = getQueryParam('link');
                var userAgent = navigator.userAgent || navigator.vendor || window.opera;
                if (link != null && link.length > 0) {
                        window.location = `chiti://home/${link}`;
                }  else {
                    window.location = 'chiti://home'
                }
                
                // var timeoutId = setTimeout(function () {
                //     if (isBlurred || didFallback) return;
                //     if (new Date().valueOf() - now > 100) return;
                //     var userAgent = navigator.userAgent || navigator.vendor || window.opera;
                //     if (/android/i.test(userAgent)) {
                //         window.location = playStoreUrl
                //     } else {
                //         window.location = appStoreUrl
                //     }
                //     didFallback = true;
                // }, 500);
                // Function to get URL parameters
                function getQueryParam(param) {
                    const params = new URLSearchParams(window.location.search);
                    return params.get(param);
                }

                document.addEventListener('visibilitychange', function() {
                    if (document.visibilityState === "hidden") {
                    // Assuming the app opened and the page is now hidden
                        // clearTimeout(timeoutId);
                        isBlurred = true;
                    }
                    if (document.visibilityState === "visible") {
                        
                    } else {
                        // clearTimeout(timeoutId);
                        isBlurred = true;
                    }
                });
            }            
            // Call this function when the user clicks your link/button
            // openAppOrStore();
            // onload="openAppOrStore()"
        </script>
        
    </head>
    <body onload="openAppOrStore()">
        Loading...
        <div id="content"></div>
    </body>
</html>
